import os

from keystoneauth1 import session
from keystoneauth1.extras.kerberos import MappedKerberos
from novaclient import client

NOVA_API_VERSION = '2'

auth = MappedKerberos(auth_url=os.environ.get('OS_AUTH_URL'),
                      project_name=os.environ.get('OS_PROJECT_NAME'),
                      project_domain_id=os.environ.get('OS_PROJECT_DOMAIN_ID'),
                      identity_provider=os.environ.get('OS_IDENTITY_PROVIDER'),
                      protocol=os.environ.get('OS_PROTOCOL'),
                      mutual_auth=os.environ.get('OS_MUTUAL_AUTH'))

sess = session.Session(auth=auth)
nova = client.Client(NOVA_API_VERSION, session=sess)
nova.servers.list()